<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../">
  <title data-ice="title">Manual | HapiServer</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
  <script src="script/matomo.js"></script>
<meta name="description" content="Template for Hapi Server"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="HapiServer"><meta property="twitter:description" content="Template for Hapi Server"></head>
<body class="layout-container manual-root manual-index" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <a href="swagger/index.html">API</a>
  <a id="healthcheck" href="">Healthcheck</a>

  <script>
    var el = document.getElementById('healthcheck')
    if (window.location.href.indexOf('github') == -1) {
      el.href = '../../admin/status';
    } else {
      el.style.color = 'grey';
      el.style.cursor = 'not-allowed';
      el.title = 'Unavailable on Github Hosting'
    }
  </script>
<a style="position:relative; top:3px;" href="https://github.com/devlinjunker/template.node.hapi"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div class="manual-toc-root">
  
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/README.setup.html"><a href="manual/README.setup.html" data-ice="link">Setup</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.setup.html"><a href="manual/README.setup.html#webpack" data-ice="link">Webpack</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.setup.html"><a href="manual/README.setup.html#documentation" data-ice="link">Documentation</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.setup.html"><a href="manual/README.setup.html#notes-ideas" data-ice="link">Notes/Ideas</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/README.entry.html"><a href="manual/README.entry.html" data-ice="link">Application Entry Point</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.entry.html"><a href="manual/README.entry.html#notes-ideas" data-ice="link">Notes/Ideas</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/README.controllers.html"><a href="manual/README.controllers.html" data-ice="link">Controllers</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.controllers.html"><a href="manual/README.controllers.html#notes-ideas" data-ice="link">Notes/Ideas</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/README.dataservices.html"><a href="manual/README.dataservices.html" data-ice="link">Dataservices</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.dataservices.html"><a href="manual/README.dataservices.html#hello-world" data-ice="link">Hello World</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.dataservices.html"><a href="manual/README.dataservices.html#note-dataservice" data-ice="link">Note Dataservice</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.dataservices.html"><a href="manual/README.dataservices.html#notes-ideas" data-ice="link">Notes/Ideas</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/README.helpers.html"><a href="manual/README.helpers.html" data-ice="link">Helpers</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.helpers.html"><a href="manual/README.helpers.html#mariadb" data-ice="link">MariaDB</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.helpers.html"><a href="manual/README.helpers.html#config" data-ice="link">Config</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.helpers.html"><a href="manual/README.helpers.html#healthcheck" data-ice="link">Healthcheck</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.helpers.html"><a href="manual/README.helpers.html#notes-ideas" data-ice="link">Notes/Ideas</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/README.hooks.html"><a href="manual/README.hooks.html" data-ice="link">Git Hooks</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.hooks.html"><a href="manual/README.hooks.html#on-commit" data-ice="link">On commit</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/README.test.html"><a href="manual/README.test.html" data-ice="link">Test</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.test.html"><a href="manual/README.test.html#notes-ideas" data-ice="link">Notes/Ideas</a></li>
</ul>
  </div>
</div>
</nav>

<div class="content" data-ice="content"><div class="github-markdown">
  <div class="manual-user-index" data-ice="manualUserIndex"><h1 id="simple-template-api-docs">Simple Template API Docs</h1><ul>
<li><a href="manual/README.setup.html">Setup</a> - dependencies and how to install and start development (eventually
production?)</li>
<li><a href="manual/README.entry.html">Entry Point</a></li>
<li><a href="manual/README.controllers.html">Controllers</a> - mappings from url endpoints to methods for handling requests</li>
<li><a href="manual/README.dataservices.html">Dataservices</a> - classes/methods that connect to external services or datastores</li>
<li><a href="manual/README.helpers.html">Helpers</a> - classes that are used frequently for interacting with other systems/tools</li>
<li><a href="manual/README.hooks.html">Git Hooks</a> - Notes about workflow enforcements</li>
<li><a href="manual/README.test.html">Test</a> - files used to run the unit tests (eventually automated tests)</li>
</ul>
<p>.</p>
</div>

  

  <div class="manual-cards">
    
  <div class="manual-card-wrap" data-ice="cards">
      <div class="manual-card">
        <div data-ice="card"><h1>Setup</h1><p><strong>Requires Node 10+</strong>. Please install this before attempting to run. The easiest way to install and
manage node versions is by using the <a href="https://github.com/nvm-sh/nvm">Node Version Manager</a>. We define a .nvm file
in the project to help reference this minimum node version.</p><p>Use <code>nvm use 10</code> to switch node versions after installing a new Node version. <strong>Then you should install all
project dependencies</strong>(<a href="https://github.com/devlinjunker/template.node.hapi/blob/master/package.json#L30">github</a>) 
with <code>npm install</code> (or <code>npm install -D</code> if development work is planned). This should install the Hapi Server Framework,
 MariaDB and other libraries used in this project.</p><p>If you have cloned the master branch, then the build should compile and all tests should pass once the
dependencies have been downloaded and installed. To only compile the server, use <code>npm run build</code>, or you can
just run the tests with <code>npm run test</code>. <strong>To watch the files for changes and rebuild/retest the files
on changes, you can use</strong> <code>npm run start-watch</code>. See the package.json(<a href="https://github.com/devlinjunker/template.node.hapi/blob/master/package.json#L17">github</a>)
for all possibe npm commands.</p><p>The Note Controller/Dataservice Endpoints require MariaDB installed to store the notes passed. After you
have installed mariadb, you will need to set up the initial database using mariadb and a SQL program (or
scripts if we get working). <strong>Once the db is set up, the configuration for the database name, user, password
and port are set in</strong> <code>conf/config.yaml</code>
(<a href="https://github.com/devlinjunker/template.node.hapi/blob/master/conf/config.yaml">github</a>).</p><p><strong>Each endpoint that is created should have an OpenAPI representation in</strong> <code>openapi.yaml</code>. This file can be
used to run <a href="https://swagger.io/tools/swagger-ui/">Swagger UI</a> to help with running/testing the processes
developed. There is a Swagger application at the API link in the docs or can view the raw
file(<a href="./manual/../swagger/openapi.yaml">source</a>) (Eventually we will autogenerate OpenAPI file from code annotations
and create Postman test suites based on these files)</p><h2>Webpack</h2><p>Webpack config file(<a href="https://github.com/devlinjunker/template.node.hapi/blob/master/webpack.config.js">github</a>)
is used to manage our webpack build to compile the application. </p><p>In this file we:</p><ul>
<li>designate the files that will be created with the build</li>
<li>define the source mapping that will be generated with the output (this should be changed in prod)</li>
<li>set the target environment and available globals</li>
<li>define where we should look to import files</li>
<li>and set up modules/plugins for the build<ul>
<li>Babel and ESLint Loaders</li>
<li>Flow Integration with Webpack</li>
<li>Hot Module Replacement for rebuilding on file changes</li>
<li>Webpack Shell Plugin to re-run Mocha tests on file changes/rebuild</li>
</ul>
</li>
</ul><h2>Documentation</h2><p>The <code>docs/</code> directory is created with <code>npm run doc</code>, this generates an esdoc webpage based on the modified
template stored in <code>docs/template</code>.</p><p>The Dependency Graph is created with <a href="https://github.com/pahen/madge">Madge</a> and graphviz, you will need to
install both in order to update the dependency graph. I didn&apos;t include these in the package.json dependencies
because I felt this is more than is needed to develop a working app or even write basic documentation.</p><p>Install madge with <code>npm install madge</code> and install graphviz with <code>brew install graphviz</code> or
<code>port install graphviz</code> (for OSX)</p><p>I split this out to a separate npm script: <code>npm run doc-image</code></p><h2>Notes/Ideas</h2><ul>
<li><strong>IDEA:</strong>  init scripts with installation and SQL setup</li>
</ul></div>
        <a data-ice="link" href="manual/README.setup.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <div class="manual-card">
        <div data-ice="card"><h1>Application Entry Point</h1><p>The main method(<a href="./manual/../file/src/entry.js.html#lineNumber47">source</a>) is where we instantiate the server wrapper
class, and set up the routes to be handled by our application. We also want to make ensure the application is
closed down as calmly as possible when the user asks, so we make sure to nicely ask our server to shut itself
down and then ask mariadb to close any open connections(<a href="./manual/../file/src/entry.js.html#lineNumber71">source</a>).</p><p>I think we also added the handler for <code>unhandledRejection</code> exceptions(<a href="./manual/../file/src/entry.js.html#lineNumber83">source</a>)
so that we print the error to output before exiting (We may also want to log this to any notification system)</p><h2>Notes/Ideas</h2><ul>
<li><strong>IDEA:</strong> Generic Handler/Middleware that creates Request Details Object to pass to each controller</li>
</ul></div>
        <a data-ice="link" href="manual/README.entry.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <div class="manual-card">
        <div data-ice="card"><h1>Controllers</h1><p>Controllers are functions that handle requests to specific endpoint paths:</p><pre><code><code class="source-code prettyprint">function controllerFunction(request) {
    ... do stuff and return a message ...
}</code>
</code></pre><p>The first parameter passed in is the <a href="https://github.com/hapijs/hapi/blob/master/API.md#request for HapiRequest">HapiRequest</a> object</p><p>We define the mapping from endpoint/method to controller function with an JSON object:</p><pre><code><code class="source-code prettyprint">const map1 = {
  path: &quot;/endpoint&quot;,
  method: &quot;GET&quot;, ///
  controller: controllerFunction
}</code>
</code></pre><p>To make this endpoint available to the server, we need to export an array of these mappings:</p><pre><code><code class="source-code prettyprint">export default [ map1, map2, ... ];</code>
</code></pre><h2>Notes/Ideas</h2><ul>
<li>OPTIONS requests?</li>
<li>Do not instantiate classes to handle requests. This would be a huge memory overhead!<ul>
<li>From Walmart interview: class methods bad for memory as we don&apos;t want to instantiate a class in memory. Seems like that isn&apos;t true for static functions though... <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/static">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/static</a></li>
<li>I prefer creating classes with <strong>static</strong>  methods for encapsulation for testing and documentation purposes</li>
</ul>
</li>
<li>DO NOT USE SHARED CLASS PROPERTIES/STATEFUL VARIABLES IN CONTROLLER FUNCTIONS<ul>
<li>These functions need to be stateless.</li>
</ul>
</li>
<li><strong>IDEA:</strong> Catch any exceptions that don&apos;t have response code and log or email indicating unexpected state</li>
<li><strong>IDEA:</strong> generic CRUD endpoints with a flexible storage system for prototypes<ul>
<li>/{objectType}/create</li>
<li>/{objectType}/read/{id}</li>
<li>/{objectType}/update/{id}</li>
<li>/{objectType}/delete/{id}</li>
<li>/{objectType}/all?filters?fields?</li>
<li>/{objectType}/search?q</li>
</ul>
</li>
</ul></div>
        <a data-ice="link" href="manual/README.controllers.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <div class="manual-card">
        <div data-ice="card"><h1>Dataservices</h1><p>Dataservices communicate with storage systems or external APIs to fetch/store data.</p><h2>Hello World</h2><p>Simple example of Hello World endpoint plus example with random value and input from path parameter</p><h2>Note Dataservice</h2><p>Create/Read Note objects out of a mariadb/mysql database</p><h2>Notes/Ideas</h2><ul>
<li>RDBMS vs Document store<ul>
<li>CAP theorem stands for C &#x2013; Consistency, A &#x2014; Availability, P &#x2014; Partitioning (or Scalability) and states that having all three properties at the same time is not possible,</li>
<li><a href="https://medium.com/statuscode/three-reasons-to-use-a-nosql-document-store-for-your-next-web-application-6b9eabffc8d8">https://medium.com/statuscode/three-reasons-to-use-a-nosql-document-store-for-your-next-web-application-6b9eabffc8d8</a></li>
<li>Document Store:<ul>
<li>use for settings data and where schema will be changed often</li>
<li>when changes are small crud, based on users interactions?</li>
<li>when count and aggregate data is useful to end user</li>
</ul>
</li>
<li>RDBMS:<ul>
<li>less duplicated data, normalized and stored in specific tables</li>
<li>useful when data changes often</li>
<li>seems like more useful for storing fact data in ETL processes?</li>
<li>Q: phoenix?</li>
</ul>
</li>
</ul>
</li>
</ul></div>
        <a data-ice="link" href="manual/README.dataservices.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <div class="manual-card">
        <div data-ice="card"><h1>Helpers</h1><p>Helpers are classes that wrap some functionality not associated with an external service</p><h2>MariaDB</h2><ul>
<li>connecting with mariadb server<ul>
<li>query</li>
<li>insert</li>
<li>fetch</li>
<li>fetchOne</li>
</ul>
</li>
</ul><h2>Config</h2><ul>
<li>reading properties from <a href="https://github.com/devlinjunker/template.node.hapi/blob/master/conf/config.yaml#L3">config file</a></li>
</ul><h2>Healthcheck</h2><ul>
<li>Make simple requests to configured DB/External Services to see if available</li>
</ul><h2>Notes/Ideas</h2><ul>
<li>Do we want/need to worry about Dependency Injection/Singletons?</li>
<li><strong>IDEA:</strong> Move Server into helpers as <code>server.helper.js</code>?</li>
</ul></div>
        <a data-ice="link" href="manual/README.helpers.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <div class="manual-card">
        <div data-ice="card"><h1>Git Hooks</h1><p>We use githooks(<a href="https://github.com/devlinjunker/template.node.hapi/tree/master/scripts/hooks">github</a>) to help clean up and enforce the workflow for developers. This is done with Husky.</p><p><strong>NOTE: We prevent commits to master branch on local machine (so all changes to master are PRs on github)</strong>. You may want to disable this for more rapid local development, you can just remove the configuration in package.json(<a href="https://github.com/devlinjunker/template.node.hapi/blob/master/package.json#L30">github</a>) that adds these hooks.</p><h2>On commit</h2><p>Before each commit, we want to verify that the build won&apos;t break. So we make sure to run the build process one more time with only the committed files before
letting the commit go through:</p><p>Process:</p><ol>
<li>Stash uncommited changes</li>
<li>Run linting/flow/compliation and tests with npm/webpack</li>
<li>Pop uncommitted changes</li>
</ol></div>
        <a data-ice="link" href="manual/README.hooks.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <div class="manual-card">
        <div data-ice="card"><h1>Test</h1><p>Testing bootstrap file(<a href="https://github.com/devlinjunker/template.node.hapi/blob/master/test/test.bootstrap.js">source</a>)
finds all of the test files and imports global objects that can be used in all tests to simplify each test
file. Also creates a sinon Sandbox that is reset before each test for mocking/stubbing services and non-tested
functions in the test context.</p><p>To run the tests with mocha, use <code>npm run test</code> to see the output from all tests in <code>.spec</code> files in the
standard output.</p><p>Global Imports (available in all <code>.spec</code> files):</p><ul>
<li><code>sinonSandbox</code> from <a href="https://sinonjs.org/">Sinon</a></li>
<li><code>expect</code> from <a href="https://www.chaijs.com/">Chai</a></li>
<li><code>describe</code>/<code>it</code>/<code>beforeEach</code> from <a href="https://mochajs.org/">Mocha</a></li>
</ul><h2>Notes/Ideas</h2><ul>
<li>[ ] Look into differences between webpack tests vs <code>npm test</code></li>
<li><strong>IDEA:</strong> Mocha settings/plugin for displaying filepath in output of tests (when erroring?)<ul>
<li>seems difficult to do on async/timeout errors</li>
</ul>
</li>
</ul></div>
        <a data-ice="link" href="manual/README.test.html"></a>
      </div>
    </div>
</div>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>

</body>
</html>
